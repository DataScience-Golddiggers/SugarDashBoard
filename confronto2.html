<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Pasticceria Geo</title>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js (Grafici) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Leaflet.js (Mappe) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* Griglia CSS: 3 Colonne, 2 Righe */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 450px); /* Aumentato leggermente per la mappa */
            gap: 20px;
        }

        /* Stile delle Card */
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 15px; /* Padding ridotto per dare spazio ai grafici */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .card h3 {
            margin-top: 0;
            font-size: 1.1rem;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .chart-container {
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 0; /* Fix per Firefox flexbox overflow */
        }

        /* Stile specifico per la mappa */
        #map {
            width: 100%;
            height: 100%;
            border-radius: 4px;
            z-index: 1;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .grid-container {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: auto;
            }
            .grid-container > div { min-height: 400px; }
        }
        @media (max-width: 768px) {
            .grid-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <h1>üìä Dashboard Analytics Pasticceria</h1>

    <div class="grid-container">

        <!-- 1. ANALISI TERRITORIALE (MAPPA LEAFLET) -->
        <div class="card">
            <h3>üìç Densit√† Dolci per Regione</h3>
            <div class="chart-container">
                <div id="map"></div>
            </div>
            <small>La dimensione del cerchio indica il n. di dolci censiti.</small>
        </div>

        <!-- 2. DOLCI PI√ô VENDUTI -->
        <div class="card">
            <h3>üèÜ Top 5 Dolci pi√π Venduti</h3>
            <div class="chart-container">
                <canvas id="chartBestSellers"></canvas>
            </div>
        </div>

        <!-- 3. INGREDIENTI PI√ô USATI -->
        <div class="card">
            <h3>uudc5 Ingredienti pi√π Utilizzati</h3>
            <div class="chart-container">
                <canvas id="chartIngredients"></canvas>
            </div>
        </div>

        <!-- 4. FATTURATO vs QUANTIT√Ä -->
        <div class="card">
            <h3>üí∞ Fatturato per Dolce (Revenue)</h3>
            <div class="chart-container">
                <canvas id="chartRevenue"></canvas>
            </div>
        </div>

        <!-- 5. COMPLESSIT√Ä -->
        <div class="card">
            <h3>‚è±Ô∏è Tempo Preparazione vs Difficolt√†</h3>
            <div class="chart-container">
                <canvas id="chartComplexity"></canvas>
            </div>
        </div>

        <!-- 6. TREND VENDITE -->
        <div class="card">
            <h3>üìà Trend Vendite (Ultimi 6 Mesi)</h3>
            <div class="chart-container">
                <canvas id="chartTrend"></canvas>
            </div>
        </div>

    </div>

    <script>
        // === 1. CONFIGURAZIONE MAPPA (Leaflet.js) ===
        
        // Dati simulati (Latitudine, Longitudine, Conteggio Dolci)
        // Usiamo le coordinate dei capoluoghi approssimativi
        const regionData = [
            { name: "Sicilia", lat: 37.5, lng: 14.0, count: 18 }, // Cerchio grande
            { name: "Campania", lat: 41.0, lng: 14.8, count: 12 },
            { name: "Lombardia", lat: 45.4, lng: 9.9, count: 7 },
            { name: "Veneto", lat: 45.6, lng: 11.8, count: 5 },
            { name: "Toscana", lat: 43.4, lng: 11.0, count: 6 },
            { name: "Piemonte", lat: 45.0, lng: 7.6, count: 4 },
            { name: "Puglia", lat: 41.0, lng: 16.5, count: 9 },
            { name: "Lazio", lat: 41.9, lng: 12.6, count: 5 }
        ];

        // Inizializza mappa centrata sull'Italia
        // zoomSnap e zoomDelta aiutano per uno scroll pi√π fluido
        const map = L.map('map', { scrollWheelZoom: false }).setView([41.9, 12.6], 5);

        // Tile Layer (sfondo mappa). Uso CartoDB Positron per un look pulito "da dashboard"
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Aggiungi cerchi
        regionData.forEach(reg => {
            L.circleMarker([reg.lat, reg.lng], {
                radius: reg.count * 1.5, // SCALING: Moltiplico il count per rendere visibile la differenza
                fillColor: "rgba(54, 162, 235, 0.8)", // Colore primario dashboard
                color: "#2c3e50", // Bordo
                weight: 1,
                opacity: 1,
                fillOpacity: 0.6
            })
            .bindPopup(`<b>${reg.name}</b><br>Dolci a catalogo: ${reg.count}`)
            .addTo(map);
        });


        // === 2. CONFIGURAZIONE CHART.JS (Altri Grafici) ===
        
        const colors = {
            primary: 'rgba(54, 162, 235, 0.7)',
            secondary: 'rgba(255, 99, 132, 0.7)',
            yellow: 'rgba(255, 206, 86, 0.7)',
            green: 'rgba(75, 192, 192, 0.7)',
            purple: 'rgba(153, 102, 255, 0.7)',
            orange: 'rgba(255, 159, 64, 0.7)'
        };

        // Grafico 2: Best Sellers
        new Chart(document.getElementById('chartBestSellers'), {
            type: 'bar',
            data: {
                labels: ['Cannolo', 'Tiramis√π', 'Bab√†', 'Panettone', 'Sfogliatella'],
                datasets: [{
                    label: 'Unit√† Vendute',
                    data: [1500, 1200, 950, 800, 750],
                    backgroundColor: [colors.secondary, colors.yellow, colors.primary, colors.green, colors.orange]
                }]
            },
            options: { maintainAspectRatio: false, responsive: true }
        });

        // Grafico 3: Ingredienti
        new Chart(document.getElementById('chartIngredients'), {
            type: 'doughnut',
            data: {
                labels: ['Zucchero', 'Farina 00', 'Uova', 'Cioccolato', 'Ricotta'],
                datasets: [{
                    data: [30, 25, 20, 15, 10],
                    backgroundColor: Object.values(colors)
                }]
            },
            options: { maintainAspectRatio: false, responsive: true, plugins: { legend: { position: 'right' } } }
        });

        // Grafico 4: Fatturato
        new Chart(document.getElementById('chartRevenue'), {
            type: 'pie',
            data: {
                labels: ['Cannolo', 'Tiramis√π', 'Bab√†', 'Altri'],
                datasets: [{
                    data: [4500, 6000, 2800, 5000],
                    backgroundColor: [colors.secondary, colors.purple, colors.yellow, '#ccc']
                }]
            },
            options: { maintainAspectRatio: false, responsive: true, plugins: { legend: { position: 'right' } } }
        });

        // Grafico 5: Complessit√†
        new Chart(document.getElementById('chartComplexity'), {
            type: 'bar',
            data: {
                labels: ['Bassa', 'Media', 'Alta'],
                datasets: [{
                    label: 'Minuti Prep.',
                    data: [25, 60, 180],
                    backgroundColor: [colors.green, colors.yellow, colors.secondary]
                }]
            },
            options: { maintainAspectRatio: false, responsive: true }
        });

        // Grafico 6: Trend
        new Chart(document.getElementById('chartTrend'), {
            type: 'line',
            data: {
                labels: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu'],
                datasets: [{
                    label: 'Fatturato (‚Ç¨)',
                    data: [12000, 11500, 14000, 16000, 15500, 18000],
                    borderColor: colors.primary,
                    fill: true,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    tension: 0.4
                }]
            },
            options: { maintainAspectRatio: false, responsive: true, scales: { y: { beginAtZero: true } } }
        });

    </script>
</body>
</html>